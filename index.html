<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeanScale Team Scorecard</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #301934;
      --primary-light: #4a2a52;
      --accent: #E8FFCF;
      --bg: #FFFBFF;
      --card-bg: #ffffff;
      --text-primary: #1a1a1a;
      --text-secondary: #666666;
      --border: #e5e5e5;
      --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-lg: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);

      /* Badge colors */
      --bronze: #CD7F32;
      --bronze-bg: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
      --silver: #C0C0C0;
      --silver-bg: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
      --gold: #FFD700;
      --gold-bg: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      --platinum: #E5E4E2;
      --platinum-bg: linear-gradient(135deg, #E5E4E2 0%, #A0B2C6 100%);

      /* Candidate colors */
      --candidate: #0d6efd;
      --candidate-light: #3d8bfd;
      --candidate-bg: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);

      /* XP bar colors */
      --xp-bg: #e0e0e0;
      --xp-fill: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Navigation */
    .nav {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--primary);
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 0.5rem;
    }

    .nav-link {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
      border: none;
      background: none;
      transition: all 0.2s;
    }

    .nav-link:hover { background: #f5f5f5; color: var(--text-primary); }
    .nav-link.active { background: var(--primary); color: white; }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Page Header */
    .page-header {
      text-align: center;
      padding: 2rem 0 2.5rem;
    }

    .page-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .page-header p {
      font-size: 1.125rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Leaderboard Stats */
    .leaderboard-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* Sections */
    .section { display: none; }
    .section.active { display: block; }

    /* Team Grid - Character Cards */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    /* Character Card */
    .character-card {
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }

    .character-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: var(--primary);
    }

    .character-card.bronze { border-color: var(--bronze); }
    .character-card.silver { border-color: var(--silver); }
    .character-card.gold { border-color: var(--gold); }
    .character-card.platinum { border-color: #A0B2C6; }

    .card-header {
      background: var(--primary);
      padding: 1.25rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: relative;
    }

    .card-header.candidate-header {
      background: var(--candidate-bg);
    }

    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--primary);
      border: 3px solid white;
      flex-shrink: 0;
    }

    .character-info {
      flex: 1;
      min-width: 0;
    }

    .character-name {
      font-size: 1.25rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.25rem;
    }

    .character-role {
      display: inline-block;
      background: var(--accent);
      color: var(--primary);
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .level-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.6rem;
      border-radius: 8px;
      font-size: 0.7rem;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
    }

    /* XP Bars Section */
    .xp-section {
      padding: 1.25rem;
    }

    .xp-group {
      margin-bottom: 1rem;
    }

    .xp-group:last-child { margin-bottom: 0; }

    .xp-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .xp-group-title {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .xp-group-score {
      font-size: 1rem;
      font-weight: 800;
      color: var(--primary);
    }

    .xp-bar-container {
      height: 12px;
      background: var(--xp-bg);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }

    .xp-bar-fill {
      height: 100%;
      background: var(--xp-fill);
      border-radius: 6px;
      transition: width 0.5s ease-out;
      position: relative;
    }

    .xp-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Badges Section */
    .badges-section {
      padding: 0 1.25rem 1.25rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .badge {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.7rem;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
      opacity: 0.3;
      transition: all 0.3s;
    }

    .badge.earned {
      opacity: 1;
      transform: scale(1);
    }

    .badge-icon {
      font-size: 0.9rem;
    }

    .badge.bronze { background: var(--bronze-bg); color: white; }
    .badge.silver { background: var(--silver-bg); color: #333; }
    .badge.gold { background: var(--gold-bg); color: #333; }
    .badge.platinum { background: var(--platinum-bg); color: #333; }

    /* Card Footer Stats */
    .card-footer {
      background: #f9f9f9;
      padding: 1rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid var(--border);
    }

    .overall-score {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .overall-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .overall-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--primary);
    }

    .view-profile-btn {
      padding: 0.5rem 1rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .view-profile-btn:hover {
      background: var(--primary-light);
      transform: translateY(-1px);
    }

    /* Modal / Focus Mode */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 2rem;
      overflow-y: auto;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: 24px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      z-index: 10;
    }

    .modal-close:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }

    .modal-header {
      background: var(--primary);
      padding: 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: relative;
    }

    .modal-header.candidate-modal-header {
      background: var(--candidate-bg);
    }

    .modal-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--primary);
      border: 4px solid white;
      flex-shrink: 0;
    }

    .modal-character-info h2 {
      font-size: 2rem;
      font-weight: 800;
      color: white;
      margin-bottom: 0.5rem;
    }

    .modal-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }

    .modal-body {
      padding: 2rem;
    }

    .context-legend {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      font-size: 0.8rem;
      flex-wrap: wrap;
    }

    .context-legend-title {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .context-legend-item {
      color: var(--text-primary);
      background: white;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
    }

    .skills-section {
      margin-bottom: 2rem;
    }

    .skills-section:last-child { margin-bottom: 0; }

    .skills-section.architect-section .skills-header {
      border-bottom-color: #9333ea;
    }

    .skills-section.architect-section .skills-avg {
      color: #9333ea;
    }

    .skills-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border);
    }

    .skills-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .skills-avg {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--primary);
    }

    .skill-row {
      background: #f9f9f9;
      border-radius: 12px;
      margin-bottom: 0.75rem;
      overflow: hidden;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .skill-row:hover {
      border-color: var(--primary);
    }

    .skill-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      cursor: pointer;
    }

    .skill-info {
      flex: 1;
    }

    .skill-name {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .skill-current-desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .skill-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .context-badge {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border: 1px solid #bae6fd;
      border-radius: 8px;
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
    }

    .context-icon {
      font-size: 0.9rem;
    }

    .context-input {
      width: 40px;
      height: 26px;
      border: 1px solid #bae6fd;
      border-radius: 4px;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
      font-family: inherit;
      background: white;
    }

    .context-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
    }

    .context-input::-webkit-inner-spin-button,
    .context-input::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .context-input[type=number] {
      -moz-appearance: textfield;
    }

    .skill-score-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .score-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 2px solid var(--border);
      background: white;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .score-btn:hover {
      border-color: var(--primary);
      background: #f5f5f5;
    }

    .score-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .skill-rubric {
      display: none;
      padding: 0 1.25rem 1rem;
      background: white;
    }

    .skill-row.expanded .skill-rubric {
      display: block;
    }

    .rubric-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .rubric-table th {
      text-align: left;
      padding: 0.5rem;
      color: var(--text-secondary);
      font-weight: 600;
      border-bottom: 1px solid var(--border);
    }

    .rubric-table td {
      padding: 0.5rem;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }

    .rubric-table tr:last-child td {
      border-bottom: none;
    }

    .rubric-score {
      width: 40px;
      text-align: center;
      font-weight: 700;
      color: var(--primary);
    }

    .rubric-table tr.current-level {
      background: var(--accent);
    }

    .expand-icon {
      color: var(--text-secondary);
      transition: transform 0.2s;
      font-size: 0.8rem;
    }

    .skill-row.expanded .expand-icon {
      transform: rotate(180deg);
    }

    /* Summary Table */
    .summary-table {
      width: 100%;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .summary-table th {
      background: var(--primary);
      color: white;
      padding: 1rem 1.25rem;
      text-align: left;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .summary-table td {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
    }

    .summary-table tr:last-child td { border-bottom: none; }
    .summary-table tr:nth-child(even) { background: #fafafa; }
    .summary-table tr:hover { background: #f5f5f5; cursor: pointer; }

    .summary-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
    }

    .btn-candidate {
      background: var(--candidate);
      color: white;
    }

    .btn-candidate:hover {
      background: var(--candidate-light);
      transform: translateY(-2px);
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-primary);
    }

    .btn-outline:hover {
      border-color: var(--primary);
      background: #f5f5f5;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
    }

    .save-btn {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      box-shadow: var(--shadow-lg);
      z-index: 50;
    }

    .toast {
      position: fixed;
      bottom: 5rem;
      right: 1.5rem;
      background: var(--accent);
      color: var(--primary);
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s;
      z-index: 50;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Legend */
    .legend {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .legend-badge {
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* Achievement Animation */
    .achievement-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: var(--card-bg);
      padding: 2rem 3rem;
      border-radius: 20px;
      text-align: center;
      box-shadow: var(--shadow-xl);
      z-index: 2000;
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .achievement-popup.show {
      transform: translate(-50%, -50%) scale(1);
    }

    .achievement-popup .badge-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .achievement-popup h3 {
      font-size: 1.5rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .achievement-popup p {
      color: var(--text-secondary);
    }

    /* Role Comparison (Home) */
    .role-comparison {
      display: flex;
      flex-direction: column;
      gap: 3rem;
    }

    .role-section {
      background: var(--card-bg);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }

    .role-header {
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      color: white;
    }

    .role-header.architects {
      background: linear-gradient(135deg, #301934 0%, #5a3d5c 100%);
    }

    .role-header.engineers {
      background: linear-gradient(135deg, #1a3a1a 0%, #2d5a2d 100%);
    }

    .role-icon {
      font-size: 3rem;
      background: rgba(255,255,255,0.15);
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .role-info {
      flex: 1;
    }

    .role-info h2 {
      font-size: 1.75rem;
      font-weight: 800;
      margin-bottom: 0.25rem;
    }

    .role-info p {
      opacity: 0.8;
      font-size: 0.95rem;
    }

    .role-stats {
      display: flex;
      gap: 2rem;
    }

    .role-stat {
      text-align: center;
      background: rgba(255,255,255,0.1);
      padding: 0.75rem 1.25rem;
      border-radius: 12px;
    }

    .role-stat-value {
      display: block;
      font-size: 1.75rem;
      font-weight: 800;
    }

    .role-stat-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.8;
    }

    .role-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.25rem;
      padding: 1.5rem;
    }

    /* Compact Character Card for Home */
    .character-card-compact {
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s;
      cursor: pointer;
    }

    .character-card-compact:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    .character-card-compact.bronze { border-color: var(--bronze); }
    .character-card-compact.silver { border-color: var(--silver); }
    .character-card-compact.gold { border-color: var(--gold); }
    .character-card-compact.platinum { border-color: #A0B2C6; }

    .compact-header {
      background: var(--primary);
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .compact-header.candidate {
      background: var(--candidate-bg);
    }

    .compact-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--primary);
      border: 2px solid white;
      flex-shrink: 0;
    }

    .compact-info {
      flex: 1;
      min-width: 0;
    }

    .compact-name {
      font-size: 1rem;
      font-weight: 700;
      color: white;
    }

    .compact-level {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.7);
    }

    .compact-badge {
      background: rgba(255,255,255,0.2);
      padding: 0.2rem 0.5rem;
      border-radius: 8px;
      font-size: 0.7rem;
      font-weight: 600;
      color: white;
    }

    .compact-stats {
      display: flex;
      padding: 0.75rem 1rem;
      gap: 0.5rem;
    }

    .compact-stat {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      background: #f5f5f5;
      border-radius: 8px;
    }

    .compact-stat-value {
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--primary);
    }

    .compact-stat-label {
      font-size: 0.6rem;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .compact-badges {
      display: flex;
      gap: 0.5rem;
      padding: 0 1rem 0.75rem;
      flex-wrap: wrap;
    }

    .compact-badges .badge {
      font-size: 0.65rem;
      padding: 0.25rem 0.5rem;
    }

    /* Candidates Section */
    .candidates-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .candidates-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .candidate-actions {
      display: flex;
      gap: 0.75rem;
    }

    .candidates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      background: #f9f9f9;
      border-radius: 20px;
      border: 2px dashed var(--border);
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .empty-state p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    /* Add Candidate Form */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .form-input, .form-select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Interview Mode */
    .interview-progress {
      background: #f5f5f5;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    .interview-progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .interview-progress-title {
      font-weight: 600;
      color: var(--text-primary);
    }

    .interview-progress-count {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .interview-progress-bar {
      height: 8px;
      background: var(--xp-bg);
      border-radius: 4px;
      overflow: hidden;
    }

    .interview-progress-fill {
      height: 100%;
      background: var(--candidate);
      border-radius: 4px;
      transition: width 0.3s;
    }

    .interview-question-card {
      background: white;
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .interview-question-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    .interview-context-badge {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border: 1px solid #fbbf24;
      border-radius: 8px;
      padding: 0.35rem 0.5rem;
      font-size: 0.75rem;
      flex-shrink: 0;
      cursor: help;
    }

    .interview-context-input {
      width: 36px;
      height: 24px;
      border: 1px solid #fbbf24;
      border-radius: 4px;
      text-align: center;
      font-size: 0.8rem;
      font-weight: 600;
      font-family: inherit;
      background: white;
    }

    .interview-context-input:focus {
      outline: none;
      border-color: var(--candidate);
      box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
    }

    .interview-context-input::placeholder {
      color: #d4a300;
    }

    .interview-context-input::-webkit-inner-spin-button,
    .interview-context-input::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .interview-context-input[type=number] {
      -moz-appearance: textfield;
    }

    .interview-skill-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--candidate);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }

    .interview-question {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.4;
      margin-bottom: 1rem;
    }

    .interview-followup {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-style: italic;
      margin-bottom: 1rem;
      padding-left: 1rem;
      border-left: 3px solid var(--border);
    }

    .interview-scoring {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .interview-score-btn {
      flex: 1;
      min-width: 60px;
      padding: 0.75rem 0.5rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .interview-score-btn:hover {
      border-color: var(--candidate);
      background: #f0f7ff;
    }

    .interview-score-btn.selected {
      border-color: var(--candidate);
      background: var(--candidate);
      color: white;
    }

    .interview-score-btn .score-num {
      display: block;
      font-size: 1.25rem;
      font-weight: 800;
    }

    .interview-score-btn .score-label {
      display: block;
      font-size: 0.65rem;
      text-transform: uppercase;
    }

    .interview-notes {
      margin-top: 1rem;
    }

    .interview-notes textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-family: inherit;
      font-size: 0.9rem;
      resize: vertical;
      min-height: 80px;
    }

    .interview-notes textarea:focus {
      outline: none;
      border-color: var(--candidate);
    }

    .interview-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .interview-section-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .interview-section-tab {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      border: 2px solid var(--border);
      background: white;
      transition: all 0.2s;
    }

    .interview-section-tab:hover {
      border-color: var(--candidate);
    }

    .interview-section-tab.active {
      background: var(--candidate);
      color: white;
      border-color: var(--candidate);
    }

    .interview-section-tab .tab-count {
      background: rgba(0,0,0,0.1);
      padding: 0.1rem 0.4rem;
      border-radius: 10px;
      font-size: 0.75rem;
      margin-left: 0.25rem;
    }

    .interview-section-tab.active .tab-count {
      background: rgba(255,255,255,0.2);
    }

    /* Candidate Status */
    .candidate-status {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .candidate-status.new {
      background: #e3f2fd;
      color: #1565c0;
    }

    .candidate-status.in-progress {
      background: #fff3e0;
      color: #e65100;
    }

    .candidate-status.complete {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .candidate-meta {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }

    .candidate-meta-item {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.7);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .leaderboard-stats { grid-template-columns: repeat(2, 1fr); }
      .team-grid { grid-template-columns: 1fr; }
      .role-grid { grid-template-columns: 1fr; }
      .candidates-grid { grid-template-columns: 1fr; }
      .nav { padding: 1rem; flex-direction: column; gap: 1rem; }
      .nav-links { flex-wrap: wrap; justify-content: center; }
      .container { padding: 1rem; }
      .modal-header { flex-direction: column; text-align: center; }
      .legend { gap: 0.75rem; }
      .role-header { flex-direction: column; text-align: center; }
      .role-stats { flex-wrap: wrap; justify-content: center; }
      .form-row { grid-template-columns: 1fr; }
      .candidates-header { flex-direction: column; align-items: stretch; }
      .candidate-actions { justify-content: center; }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <a href="#" class="nav-logo">
      <span>üéÆ</span> LeanScale Scorecard
    </a>
    <div class="nav-links">
      <button class="nav-link active" data-tab="home">Home</button>
      <button class="nav-link" data-tab="team">Full Roster</button>
      <button class="nav-link" data-tab="candidates">Candidates</button>
      <button class="nav-link" data-tab="leaderboard">Leaderboard</button>
    </div>
  </nav>

  <div class="container">
    <div class="page-header">
      <h1>üèÜ Team Skills Arena</h1>
      <p>Level up your team. Track progress. Earn badges.</p>
    </div>

    <div class="legend">
      <div class="legend-item">
        <span class="legend-badge badge bronze earned">ü•â Bronze</span>
        <span>1.0 - 2.4</span>
      </div>
      <div class="legend-item">
        <span class="legend-badge badge silver earned">ü•à Silver</span>
        <span>2.5 - 3.4</span>
      </div>
      <div class="legend-item">
        <span class="legend-badge badge gold earned">ü•á Gold</span>
        <span>3.5 - 4.4</span>
      </div>
      <div class="legend-item">
        <span class="legend-badge badge platinum earned">üíé Platinum</span>
        <span>4.5 - 5.0</span>
      </div>
    </div>

    <div id="home" class="section active">
      <div class="role-comparison">
        <div class="role-section">
          <div class="role-header architects">
            <div class="role-icon">üèõÔ∏è</div>
            <div class="role-info">
              <h2>Architects</h2>
              <p id="architectCount">0 members</p>
            </div>
            <div class="role-stats">
              <div class="role-stat">
                <span class="role-stat-value" id="architectTech">‚Äî</span>
                <span class="role-stat-label">Technical</span>
              </div>
              <div class="role-stat">
                <span class="role-stat-value" id="architectSoft">‚Äî</span>
                <span class="role-stat-label">Soft Skills</span>
              </div>
              <div class="role-stat">
                <span class="role-stat-value" id="architectOverall">‚Äî</span>
                <span class="role-stat-label">Overall</span>
              </div>
            </div>
          </div>
          <div class="role-grid" id="architectGrid"></div>
        </div>

        <div class="role-section">
          <div class="role-header engineers">
            <div class="role-icon">‚öôÔ∏è</div>
            <div class="role-info">
              <h2>Engineers</h2>
              <p id="engineerCount">0 members</p>
            </div>
            <div class="role-stats">
              <div class="role-stat">
                <span class="role-stat-value" id="engineerTech">‚Äî</span>
                <span class="role-stat-label">Technical</span>
              </div>
              <div class="role-stat">
                <span class="role-stat-value" id="engineerSoft">‚Äî</span>
                <span class="role-stat-label">Soft Skills</span>
              </div>
              <div class="role-stat">
                <span class="role-stat-value" id="engineerOverall">‚Äî</span>
                <span class="role-stat-label">Overall</span>
              </div>
            </div>
          </div>
          <div class="role-grid" id="engineerGrid"></div>
        </div>
      </div>
    </div>

    <div id="team" class="section">
      <div class="leaderboard-stats">
        <div class="stat-card">
          <div class="stat-value" id="totalTeam">15</div>
          <div class="stat-label">Team Members</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgTech">‚Äî</div>
          <div class="stat-label">Avg Technical</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgSoft">‚Äî</div>
          <div class="stat-label">Avg Soft Skills</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgOverall">‚Äî</div>
          <div class="stat-label">Team Level</div>
        </div>
      </div>

      <div class="team-grid" id="teamGrid"></div>
    </div>

    <div id="candidates" class="section">
      <div class="candidates-header">
        <h2>üë• Candidate Pipeline</h2>
        <div class="candidate-actions">
          <button class="btn btn-candidate" onclick="openAddCandidateModal()">
            ‚ûï Add Candidate
          </button>
        </div>
      </div>
      <div id="candidatesContent"></div>
    </div>

    <div id="leaderboard" class="section">
      <table class="summary-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Role</th>
            <th>Technical</th>
            <th>Soft Skills</th>
            <th>Overall</th>
            <th>Tier</th>
          </tr>
        </thead>
        <tbody id="leaderboardBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Profile Modal (Team) -->
  <div class="modal-overlay" id="profileModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <div class="modal-header" id="modalHeader"></div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <!-- Add Candidate Modal -->
  <div class="modal-overlay" id="addCandidateModal">
    <div class="modal-content" style="max-width: 500px;">
      <button class="modal-close" onclick="closeAddCandidateModal()">&times;</button>
      <div class="modal-header candidate-modal-header">
        <div class="modal-avatar">üë§</div>
        <div class="modal-character-info">
          <h2>Add New Candidate</h2>
          <span class="character-role">Interview Assessment</span>
        </div>
      </div>
      <div class="modal-body">
        <form id="addCandidateForm" onsubmit="addCandidate(event)">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">First Name *</label>
              <input type="text" class="form-input" id="candidateFirstName" required>
            </div>
            <div class="form-group">
              <label class="form-label">Last Name *</label>
              <input type="text" class="form-input" id="candidateLastName" required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="candidateEmail">
          </div>
          <div class="form-group">
            <label class="form-label">Target Role *</label>
            <select class="form-select" id="candidateRole" required>
              <option value="">Select a role...</option>
              <option value="Engineer">Engineer</option>
              <option value="Architect">Architect</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Source</label>
            <input type="text" class="form-input" id="candidateSource" placeholder="e.g., Referral, LinkedIn, Job Board">
          </div>
          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button type="button" class="btn btn-outline" style="flex:1" onclick="closeAddCandidateModal()">Cancel</button>
            <button type="submit" class="btn btn-candidate" style="flex:1">Add & Start Interview</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Candidate Interview Modal -->
  <div class="modal-overlay" id="candidateModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeCandidateModal()">&times;</button>
      <div class="modal-header candidate-modal-header" id="candidateModalHeader"></div>
      <div class="modal-body" id="candidateModalBody"></div>
    </div>
  </div>

  <!-- Achievement Popup -->
  <div class="achievement-popup" id="achievementPopup">
    <div class="badge-icon" id="achievementIcon">üèÜ</div>
    <h3 id="achievementTitle">Badge Earned!</h3>
    <p id="achievementDesc">You've reached a new level!</p>
  </div>

  <button class="btn btn-primary save-btn" onclick="saveData()">üíæ Save Progress</button>
  <div class="toast" id="toast">‚ú® Progress saved!</div>

<script>
const TECHNICAL_SKILLS = [
  { key: 'planning_pipeline', label: 'Planning (Pipeline)', category: 'Pipeline Ops' },
  { key: 'planning_revenue', label: 'Planning (Revenue)', category: 'Revenue Ops' },
  { key: 'process_pipeline', label: 'Process (Pipeline)', category: 'Pipeline Ops' },
  { key: 'process_revenue', label: 'Process (Revenue)', category: 'Revenue Ops' },
  { key: 'systems_pipeline', label: 'Systems (Pipeline)', category: 'Pipeline Ops' },
  { key: 'systems_revenue', label: 'Systems (Revenue)', category: 'Revenue Ops' },
  { key: 'reporting_pipeline', label: 'Reporting (Pipeline)', category: 'Pipeline Ops' },
  { key: 'reporting_revenue', label: 'Reporting (Revenue)', category: 'Revenue Ops' },
  { key: 'enablement_pipeline', label: 'Enablement (Pipeline)', category: 'Pipeline Ops' },
  { key: 'enablement_revenue', label: 'Enablement (Revenue)', category: 'Revenue Ops' },
  { key: 'people_pipeline', label: 'People (Pipeline)', category: 'Pipeline Ops' },
  { key: 'people_revenue', label: 'People (Revenue)', category: 'Revenue Ops' }
];

const SOFT_SKILLS = [
  { key: 'communication', label: 'Communication' },
  { key: 'organization', label: 'Organization' },
  { key: 'diligence', label: 'Diligence' },
  { key: 'leadership', label: 'Leadership' },
  { key: 'value_alignment', label: 'Value Alignment' }
];

// Architect-only skills
const ARCHITECT_SKILLS = [
  { key: 'responsiveness', label: 'Responsiveness' },
  { key: 'roadmap_planning', label: 'Roadmap Planning' },
  { key: 'proactivity', label: 'Proactivity' },
  { key: 'strategic_value', label: 'Strategic Value' }
];

const TECHNICAL_RUBRICS = {
  'planning_pipeline': [
    { score: 1, desc: 'Learning basic planning concepts; needs guidance on growth models and budgeting' },
    { score: 2, desc: 'Can follow established planning frameworks; assists with quota/budget creation' },
    { score: 3, desc: 'Independently builds channel quotas, marketing budgets, and ICP analysis' },
    { score: 4, desc: 'Designs multi-channel pipeline planning strategies; leads planning sessions' },
    { score: 5, desc: 'Creates innovative planning methodologies; benchmarks against industry best practices' }
  ],
  'planning_revenue': [
    { score: 1, desc: 'Learning capacity planning basics; needs guidance on territory design' },
    { score: 2, desc: 'Can follow established capacity models; assists with territory assignments' },
    { score: 3, desc: 'Independently builds capacity plans, territory designs, and sales quotas' },
    { score: 4, desc: 'Designs complex territory strategies; optimizes quota distribution' },
    { score: 5, desc: 'Creates scalable planning frameworks; advises on M&A territory integration' }
  ],
  'process_pipeline': [
    { score: 1, desc: 'Learning lead lifecycle concepts; needs guidance on routing rules' },
    { score: 2, desc: 'Can configure basic lead routing; understands lifecycle stages' },
    { score: 3, desc: 'Designs lead lifecycle, scoring models, and attribution methodology' },
    { score: 4, desc: 'Optimizes conversion across lifecycle; implements ABM processes' },
    { score: 5, desc: 'Innovates lifecycle automation; creates industry-leading attribution models' }
  ],
  'process_revenue': [
    { score: 1, desc: 'Learning sales lifecycle basics; needs guidance on handoff processes' },
    { score: 2, desc: 'Can configure basic sales stages; understands opportunity management' },
    { score: 3, desc: 'Designs sales lifecycle, handoffs, and comp plan structures' },
    { score: 4, desc: 'Optimizes sales methodology; implements complex CPQ workflows' },
    { score: 5, desc: 'Creates scalable sales processes; designs enterprise deal desk operations' }
  ],
  'systems_pipeline': [
    { score: 1, desc: 'Learning MAP basics; needs guidance on system configuration' },
    { score: 2, desc: 'Can perform basic MAP tasks; understands CRM-MAP integration' },
    { score: 3, desc: 'Independently manages MAP, ABM platforms, and email automation' },
    { score: 4, desc: 'Architects complex integrations; optimizes tech stack performance' },
    { score: 5, desc: 'Designs enterprise-scale martech architecture; evaluates emerging tools' }
  ],
  'systems_revenue': [
    { score: 1, desc: 'Learning CRM basics; needs guidance on system administration' },
    { score: 2, desc: 'Can perform basic CRM tasks; understands sales automation' },
    { score: 3, desc: 'Independently manages CRM, CPQ, and revenue intelligence tools' },
    { score: 4, desc: 'Architects complex sales tech stack; implements conversation intelligence' },
    { score: 5, desc: 'Designs enterprise-scale revenue architecture; leads system migrations' }
  ],
  'reporting_pipeline': [
    { score: 1, desc: 'Learning basic reporting; needs guidance on metrics' },
    { score: 2, desc: 'Can build simple reports; understands marketing KPIs' },
    { score: 3, desc: 'Builds daily/weekly/monthly marketing reports independently' },
    { score: 4, desc: 'Designs executive dashboards; creates predictive pipeline models' },
    { score: 5, desc: 'Innovates reporting methodology; builds board-level marketing analytics' }
  ],
  'reporting_revenue': [
    { score: 1, desc: 'Learning basic reporting; needs guidance on sales metrics' },
    { score: 2, desc: 'Can build simple reports; understands revenue KPIs' },
    { score: 3, desc: 'Builds daily/weekly/monthly revenue reports independently' },
    { score: 4, desc: 'Designs executive dashboards; creates forecasting models' },
    { score: 5, desc: 'Innovates reporting methodology; builds board-level revenue analytics' }
  ],
  'enablement_pipeline': [
    { score: 1, desc: 'Learning enablement basics; needs guidance on content management' },
    { score: 2, desc: 'Can update existing enablement materials; understands training needs' },
    { score: 3, desc: 'Creates marketing enablement content; manages enablement platforms' },
    { score: 4, desc: 'Designs comprehensive enablement programs; leads training sessions' },
    { score: 5, desc: 'Innovates enablement methodology; builds scalable training frameworks' }
  ],
  'enablement_revenue': [
    { score: 1, desc: 'Learning enablement basics; needs guidance on sales training' },
    { score: 2, desc: 'Can update existing materials; understands rep onboarding needs' },
    { score: 3, desc: 'Creates sales enablement content; manages playbooks and QBRs' },
    { score: 4, desc: 'Designs comprehensive sales training; leads methodology rollouts' },
    { score: 5, desc: 'Innovates enablement methodology; builds enterprise onboarding programs' }
  ],
  'people_pipeline': [
    { score: 1, desc: 'Learning team dynamics; needs guidance on cross-functional work' },
    { score: 2, desc: 'Collaborates effectively with marketing/partner teams' },
    { score: 3, desc: 'Manages stakeholder relationships; coordinates cross-team initiatives' },
    { score: 4, desc: 'Leads cross-functional projects; mentors junior team members' },
    { score: 5, desc: 'Builds high-performing teams; advises on org design and hiring' }
  ],
  'people_revenue': [
    { score: 1, desc: 'Learning team dynamics; needs guidance on sales/CS collaboration' },
    { score: 2, desc: 'Collaborates effectively with sales/CS teams' },
    { score: 3, desc: 'Manages stakeholder relationships; coordinates revenue initiatives' },
    { score: 4, desc: 'Leads cross-functional projects; mentors junior team members' },
    { score: 5, desc: 'Builds high-performing teams; advises on revenue org structure' }
  ]
};

const SOFT_RUBRICS = {
  'communication': [
    { score: 1, desc: 'Struggles to articulate ideas clearly; written/verbal communication needs improvement' },
    { score: 2, desc: 'Communicates adequately but sometimes lacks clarity or conciseness' },
    { score: 3, desc: 'Clear and effective communicator; adapts style to audience; handles client calls professionally' },
    { score: 4, desc: 'Excellent communicator; leads client presentations confidently; navigates difficult conversations' },
    { score: 5, desc: 'Exceptional communicator; inspires and influences at executive level; trusted advisor status' }
  ],
  'organization': [
    { score: 1, desc: 'Struggles with task management; often misses deadlines; needs frequent reminders' },
    { score: 2, desc: 'Manages routine tasks adequately; occasionally misses details' },
    { score: 3, desc: 'Well-organized; manages multiple projects effectively; meets deadlines consistently' },
    { score: 4, desc: 'Highly organized; manages complex workloads seamlessly; helps organize team efforts' },
    { score: 5, desc: 'Exceptionally organized; creates systems others adopt; brings order to ambiguous situations' }
  ],
  'diligence': [
    { score: 1, desc: 'Work quality inconsistent; requires multiple reviews; needs oversight' },
    { score: 2, desc: 'Adequate attention to detail; occasional errors; completes work but may miss edge cases' },
    { score: 3, desc: 'Thorough and reliable; double-checks work; catches own mistakes; consistent quality' },
    { score: 4, desc: 'Meticulous attention to detail; goes above standard; anticipates issues before they arise' },
    { score: 5, desc: 'Exceptional diligence; sets quality standard for team; catches issues others miss' }
  ],
  'leadership': [
    { score: 1, desc: 'Hesitant to take initiative; waits for direction; uncomfortable leading' },
    { score: 2, desc: 'Takes initiative on familiar tasks; can lead small efforts with guidance' },
    { score: 3, desc: 'Proactively leads projects; makes decisions confidently; takes ownership of outcomes' },
    { score: 4, desc: 'Strong leader; inspires others; navigates ambiguity well; develops junior members' },
    { score: 5, desc: 'Exceptional leader; builds and motivates high-performing teams; influences strategy' }
  ],
  'value_alignment': [
    { score: 1, desc: 'Actions sometimes conflict with company values; cultural fit unclear' },
    { score: 2, desc: 'Generally aligned with values; occasional lapses; understands expectations' },
    { score: 3, desc: 'Consistently demonstrates company values; acts with integrity; client-first mindset' },
    { score: 4, desc: 'Strong values ambassador; models behavior for others; elevates culture' },
    { score: 5, desc: 'Exceptional values alignment; defines and shapes culture; embodies company mission' }
  ]
};

// Architect-specific skill rubrics
const ARCHITECT_RUBRICS = {
  'responsiveness': [
    { score: 1, desc: 'Slow to respond to client/team needs; often requires follow-ups; communication gaps cause delays' },
    { score: 2, desc: 'Responds within reasonable timeframes; occasionally needs reminders on urgent items' },
    { score: 3, desc: 'Consistently responsive; acknowledges requests promptly; sets clear expectations on timelines' },
    { score: 4, desc: 'Highly responsive; anticipates needs before asked; keeps stakeholders proactively informed' },
    { score: 5, desc: 'Exemplary responsiveness; creates systems for rapid response; clients cite as key differentiator' }
  ],
  'roadmap_planning': [
    { score: 1, desc: 'Struggles to plan beyond immediate tasks; roadmaps unclear or frequently missed' },
    { score: 2, desc: 'Can create basic project plans; needs help sequencing dependencies and milestones' },
    { score: 3, desc: 'Builds clear 30/60/90 day roadmaps; manages dependencies; adjusts plans based on learnings' },
    { score: 4, desc: 'Creates strategic multi-quarter roadmaps; balances quick wins with long-term value; strong stakeholder buy-in' },
    { score: 5, desc: 'Transforms ambiguous situations into clear roadmaps; roadmaps become client reference points; teaches methodology' }
  ],
  'proactivity': [
    { score: 1, desc: 'Waits to be told what to do; rarely identifies issues or opportunities independently' },
    { score: 2, desc: 'Occasionally flags issues; needs prompting to think ahead; reactive more than proactive' },
    { score: 3, desc: 'Regularly identifies risks and opportunities; brings solutions not just problems; stays ahead of blockers' },
    { score: 4, desc: 'Anticipates client needs before they arise; proactively improves processes; drives initiatives without being asked' },
    { score: 5, desc: 'Sets the standard for proactive thinking; transforms client relationships through anticipation; mentors others on proactivity' }
  ],
  'strategic_value': [
    { score: 1, desc: 'Focuses only on tactical execution; struggles to connect work to business outcomes' },
    { score: 2, desc: 'Understands strategic context when explained; can articulate value with guidance' },
    { score: 3, desc: 'Connects tactical work to strategic goals; quantifies impact; communicates value to stakeholders' },
    { score: 4, desc: 'Shapes client strategy; identifies high-impact opportunities; becomes trusted strategic advisor' },
    { score: 5, desc: 'Drives transformational value; influences C-level decisions; work becomes case study material' }
  ]
};

// Interview Questions - Startup-focused, quick and punchy
const INTERVIEW_QUESTIONS = {
  // Technical Skills - Pipeline
  'planning_pipeline': {
    primary: "Walk me through how you'd build a marketing budget from scratch for a new channel. What's your process?",
    followup: "How do you decide how much to allocate to each channel when you have limited data?",
    lookFor: "Look for: structured approach, ICP thinking, budget rationale, growth model understanding"
  },
  'planning_revenue': {
    primary: "You need to redesign territories for a sales team that just doubled. Where do you start?",
    followup: "How do you handle the politics when reps lose accounts they've been working?",
    lookFor: "Look for: data-driven approach, fairness considerations, change management awareness"
  },
  'process_pipeline': {
    primary: "Our lead-to-opportunity conversion just dropped 20%. How do you diagnose and fix it?",
    followup: "What's your philosophy on lead scoring - how simple or complex should it be?",
    lookFor: "Look for: systematic troubleshooting, lifecycle understanding, attribution knowledge"
  },
  'process_revenue': {
    primary: "Sales says deals are getting stuck in the pipeline. What do you look at first?",
    followup: "Tell me about a handoff process you designed between teams. What made it work?",
    lookFor: "Look for: stage analysis, bottleneck identification, cross-functional process design"
  },
  'systems_pipeline': {
    primary: "You're inheriting a messy Marketo/HubSpot instance. What's your first week look like?",
    followup: "When would you recommend a company switch from HubSpot to Marketo, or vice versa?",
    lookFor: "Look for: audit methodology, integration knowledge, platform expertise"
  },
  'systems_revenue': {
    primary: "The CRM is a mess - duplicates everywhere, fields nobody uses, reps hate it. What's your plan?",
    followup: "How do you balance CRM simplicity for reps vs. data needs for leadership?",
    lookFor: "Look for: cleanup strategy, user empathy, data architecture thinking"
  },
  'reporting_pipeline': {
    primary: "CMO asks: 'Is our marketing working?' What dashboard do you build to answer that?",
    followup: "How do you handle attribution when you have long sales cycles and multiple touches?",
    lookFor: "Look for: metric selection, executive communication, attribution models"
  },
  'reporting_revenue': {
    primary: "Build me a weekly forecast report from scratch. What metrics matter most?",
    followup: "Sales leadership doesn't trust the forecast. How do you improve accuracy?",
    lookFor: "Look for: forecasting methodology, pipeline metrics, data quality awareness"
  },
  'enablement_pipeline': {
    primary: "Marketing team isn't using the content that sales needs. How do you fix the gap?",
    followup: "What's your approach to training marketing team members on new tools?",
    lookFor: "Look for: content strategy, cross-team alignment, training methodology"
  },
  'enablement_revenue': {
    primary: "You have 2 weeks to onboard 5 new reps. What's your playbook?",
    followup: "How do you measure if enablement is actually working?",
    lookFor: "Look for: onboarding structure, ramp metrics, content organization"
  },
  'people_pipeline': {
    primary: "Marketing and Sales are pointing fingers about lead quality. How do you get them aligned?",
    followup: "Tell me about a time you had to push back on a stakeholder's request. How'd you handle it?",
    lookFor: "Look for: conflict resolution, relationship building, influencing skills"
  },
  'people_revenue': {
    primary: "Sales VP wants one thing, CS VP wants another, both impact your project. What do you do?",
    followup: "How do you build trust with sales reps who've been burned by ops before?",
    lookFor: "Look for: stakeholder management, prioritization, trust building"
  },

  // Soft Skills
  'communication': {
    primary: "Tell me about a time you had to explain something complex to someone non-technical.",
    followup: "How do you handle it when you realize mid-meeting that you've lost your audience?",
    lookFor: "Look for: clarity, audience adaptation, self-awareness"
  },
  'organization': {
    primary: "Walk me through how you manage your work when you have 5 priorities all marked 'urgent'.",
    followup: "How do you keep track of everything when things are moving fast?",
    lookFor: "Look for: prioritization framework, tools/systems, realistic about tradeoffs"
  },
  'diligence': {
    primary: "Tell me about a time you caught an error that everyone else missed. What happened?",
    followup: "How do you balance speed vs. thoroughness in a fast-moving startup?",
    lookFor: "Look for: attention to detail, quality standards, practical tradeoffs"
  },
  'leadership': {
    primary: "Tell me about a time you led something without having formal authority over the people involved.",
    followup: "How do you handle it when someone on the project isn't pulling their weight?",
    lookFor: "Look for: influence without authority, accountability, initiative"
  },
  'value_alignment': {
    primary: "What's the most important thing you look for in a company's culture?",
    followup: "Tell me about a time your values conflicted with what was being asked of you. What did you do?",
    lookFor: "Look for: self-awareness, integrity, client-first mindset"
  },

  // Architect-Only Skills
  'responsiveness': {
    primary: "It's Friday 4pm and a client pings with an 'urgent' request. Walk me through your decision process.",
    followup: "How do you balance responsiveness with protecting your own time and avoiding burnout?",
    lookFor: "Look for: prioritization instincts, client empathy, boundary-setting, communication about timelines"
  },
  'roadmap_planning': {
    primary: "You're 2 weeks into a new client engagement and they ask 'what's our 90-day plan?' How do you build it?",
    followup: "The roadmap gets blown up by a new priority mid-quarter. What's your approach?",
    lookFor: "Look for: structured planning process, stakeholder alignment, flexibility, milestone thinking"
  },
  'proactivity': {
    primary: "Tell me about a time you identified a problem before anyone asked you to look at it. What happened?",
    followup: "How do you stay ahead of issues without becoming annoying or overstepping?",
    lookFor: "Look for: pattern recognition, initiative, relationship awareness, solutions-oriented thinking"
  },
  'strategic_value': {
    primary: "Give me an example where you turned a tactical task into strategic impact for a client.",
    followup: "How do you communicate value to a skeptical executive who thinks ops is just 'keeping the lights on'?",
    lookFor: "Look for: business acumen, ROI thinking, executive communication, elevating the conversation"
  }
};

let teamData = [
  { name: 'David', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'John', role: 'Architect', scores: {}, contextData: {} },
  { name: 'Derek', role: 'Architect', scores: {}, contextData: {} },
  { name: 'Christopher', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Brian', role: 'Architect', scores: {}, contextData: {} },
  { name: 'Kavean', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Isabelle', role: 'Architect', scores: {}, contextData: {} },
  { name: 'Eduardo', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Raphael', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Rodolfo', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Amanda', role: 'Architect', scores: {}, contextData: {} },
  { name: 'Solange', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Diego', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Ambrstack', role: 'Engineer', scores: {}, contextData: {} },
  { name: 'Sarmad', role: 'Engineer', scores: {}, contextData: {} }
];

// Context labels for different skill types
const CONTEXT_LABELS = {
  technical: { label: 'Projects', icon: 'üìÅ' },
  soft: { label: 'Customer At-Bats', icon: 'ü§ù' },
  architect: { label: 'Engagements', icon: 'üè¢' }
};

let candidatesData = [];
let currentPersonIdx = null;
let currentCandidateIdx = null;
let currentInterviewSection = 'all';
let previousBadges = {};

// Load saved data
const savedTeam = localStorage.getItem('leanscale_scorecard_v2');
if (savedTeam) {
  teamData = JSON.parse(savedTeam);
  // Migrate: ensure all team members have contextData
  teamData.forEach(p => {
    if (!p.contextData) p.contextData = {};
  });
}

const savedCandidates = localStorage.getItem('leanscale_candidates');
if (savedCandidates) {
  candidatesData = JSON.parse(savedCandidates);
  // Migrate: ensure all candidates have contextData
  candidatesData.forEach(c => {
    if (!c.contextData) c.contextData = {};
  });
}

// Initialize previous badges state
teamData.forEach((p, idx) => {
  previousBadges[idx] = {
    tech: getBadgeTier(calculateAvg(p, TECHNICAL_SKILLS)),
    soft: getBadgeTier(calculateAvg(p, SOFT_SKILLS))
  };
});

function getInitials(name) {
  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
}

function calculateAvg(person, skills) {
  const vals = skills.map(s => person.scores[s.key]).filter(v => v && v > 0);
  if (vals.length === 0) return null;
  return (vals.reduce((a, b) => a + b, 0) / vals.length).toFixed(1);
}

function getBadgeTier(avg) {
  if (!avg) return null;
  const val = parseFloat(avg);
  if (val >= 4.5) return 'platinum';
  if (val >= 3.5) return 'gold';
  if (val >= 2.5) return 'silver';
  if (val >= 1.0) return 'bronze';
  return null;
}

function getBadgeIcon(tier) {
  const icons = { bronze: 'ü•â', silver: 'ü•à', gold: 'ü•á', platinum: 'üíé' };
  return icons[tier] || '';
}

function getBadgeLabel(tier) {
  const labels = { bronze: 'Bronze', silver: 'Silver', gold: 'Gold', platinum: 'Platinum' };
  return labels[tier] || '';
}

function getCardTierClass(person) {
  const overall = calculateAvg(person, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
  return getBadgeTier(overall) || '';
}

function getXPPercentage(avg) {
  if (!avg) return 0;
  return (parseFloat(avg) / 5) * 100;
}

function getCurrentLevelDesc(skillKey, score, isTechnical = true, isArchitect = false) {
  let rubrics;
  if (isArchitect) {
    rubrics = ARCHITECT_RUBRICS[skillKey];
  } else if (isTechnical) {
    rubrics = TECHNICAL_RUBRICS[skillKey];
  } else {
    rubrics = SOFT_RUBRICS[skillKey];
  }
  if (!rubrics || !score) return 'No score yet - click to evaluate';
  const item = rubrics.find(r => r.score === score);
  return item ? item.desc : 'No score yet - click to evaluate';
}

function getCandidateStatus(candidate) {
  const isArchitect = candidate.role === 'Architect';
  const totalSkills = TECHNICAL_SKILLS.length + SOFT_SKILLS.length + (isArchitect ? ARCHITECT_SKILLS.length : 0);
  const scoredSkills = Object.values(candidate.scores || {}).filter(v => v && v > 0).length;
  if (scoredSkills === 0) return 'new';
  if (scoredSkills < totalSkills) return 'in-progress';
  return 'complete';
}

function getCandidateStatusLabel(status) {
  const labels = { 'new': 'New', 'in-progress': 'In Progress', 'complete': 'Complete' };
  return labels[status] || status;
}

function updateGlobalStats() {
  const allTech = [], allSoft = [], allOverall = [];
  teamData.forEach(p => {
    const t = calculateAvg(p, TECHNICAL_SKILLS);
    const s = calculateAvg(p, SOFT_SKILLS);
    const o = calculateAvg(p, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
    if (t) allTech.push(parseFloat(t));
    if (s) allSoft.push(parseFloat(s));
    if (o) allOverall.push(parseFloat(o));
  });

  document.getElementById('avgTech').textContent = allTech.length ? (allTech.reduce((a,b)=>a+b,0)/allTech.length).toFixed(1) : '‚Äî';
  document.getElementById('avgSoft').textContent = allSoft.length ? (allSoft.reduce((a,b)=>a+b,0)/allSoft.length).toFixed(1) : '‚Äî';
  document.getElementById('avgOverall').textContent = allOverall.length ? (allOverall.reduce((a,b)=>a+b,0)/allOverall.length).toFixed(1) : '‚Äî';
}

function renderTeamGrid() {
  const grid = document.getElementById('teamGrid');
  grid.innerHTML = teamData.map((person, idx) => {
    const techAvg = calculateAvg(person, TECHNICAL_SKILLS);
    const softAvg = calculateAvg(person, SOFT_SKILLS);
    const overallAvg = calculateAvg(person, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
    const tierClass = getCardTierClass(person);
    const techBadge = getBadgeTier(techAvg);
    const softBadge = getBadgeTier(softAvg);

    return `
      <div class="character-card ${tierClass}" onclick="openProfile(${idx})">
        <div class="card-header">
          <div class="avatar">${getInitials(person.name)}</div>
          <div class="character-info">
            <div class="character-name">${person.name}</div>
            <span class="character-role">${person.role}</span>
          </div>
          ${overallAvg ? `<div class="level-badge">LVL ${Math.floor(parseFloat(overallAvg))}</div>` : ''}
        </div>
        <div class="xp-section">
          <div class="xp-group">
            <div class="xp-group-header">
              <span class="xp-group-title">Technical Skills</span>
              <span class="xp-group-score">${techAvg || '‚Äî'}</span>
            </div>
            <div class="xp-bar-container">
              <div class="xp-bar-fill" style="width: ${getXPPercentage(techAvg)}%"></div>
            </div>
          </div>
          <div class="xp-group">
            <div class="xp-group-header">
              <span class="xp-group-title">Soft Skills</span>
              <span class="xp-group-score">${softAvg || '‚Äî'}</span>
            </div>
            <div class="xp-bar-container">
              <div class="xp-bar-fill" style="width: ${getXPPercentage(softAvg)}%"></div>
            </div>
          </div>
        </div>
        <div class="badges-section">
          <div class="badge bronze ${techBadge === 'bronze' ? 'earned' : ''}"><span class="badge-icon">ü•â</span> Tech</div>
          <div class="badge silver ${techBadge === 'silver' ? 'earned' : ''}"><span class="badge-icon">ü•à</span> Tech</div>
          <div class="badge gold ${techBadge === 'gold' ? 'earned' : ''}"><span class="badge-icon">ü•á</span> Tech</div>
          <div class="badge platinum ${techBadge === 'platinum' ? 'earned' : ''}"><span class="badge-icon">üíé</span> Tech</div>
          <div class="badge bronze ${softBadge === 'bronze' ? 'earned' : ''}"><span class="badge-icon">ü•â</span> Soft</div>
          <div class="badge silver ${softBadge === 'silver' ? 'earned' : ''}"><span class="badge-icon">ü•à</span> Soft</div>
          <div class="badge gold ${softBadge === 'gold' ? 'earned' : ''}"><span class="badge-icon">ü•á</span> Soft</div>
          <div class="badge platinum ${softBadge === 'platinum' ? 'earned' : ''}"><span class="badge-icon">üíé</span> Soft</div>
        </div>
        <div class="card-footer">
          <div class="overall-score">
            <span class="overall-label">Overall</span>
            <span class="overall-value">${overallAvg || '‚Äî'}</span>
          </div>
          <button class="view-profile-btn" onclick="event.stopPropagation(); openProfile(${idx})">Review Skills ‚Üí</button>
        </div>
      </div>
    `;
  }).join('');
  updateGlobalStats();
}

function renderLeaderboard() {
  const sorted = teamData.map((p, idx) => ({
    ...p, idx,
    techAvg: calculateAvg(p, TECHNICAL_SKILLS),
    softAvg: calculateAvg(p, SOFT_SKILLS),
    overallAvg: calculateAvg(p, [...TECHNICAL_SKILLS, ...SOFT_SKILLS])
  })).sort((a, b) => {
    if (!a.overallAvg && !b.overallAvg) return 0;
    if (!a.overallAvg) return 1;
    if (!b.overallAvg) return -1;
    return parseFloat(b.overallAvg) - parseFloat(a.overallAvg);
  });

  document.getElementById('leaderboardBody').innerHTML = sorted.map((person, rank) => {
    const tier = getBadgeTier(person.overallAvg);
    return `
      <tr onclick="openProfile(${person.idx})">
        <td><strong>#${rank + 1}</strong></td>
        <td><strong>${person.name}</strong></td>
        <td>${person.role}</td>
        <td>${person.techAvg || '‚Äî'}</td>
        <td>${person.softAvg || '‚Äî'}</td>
        <td><strong>${person.overallAvg || '‚Äî'}</strong></td>
        <td>${tier ? `<span class="summary-badge badge ${tier} earned">${getBadgeIcon(tier)} ${getBadgeLabel(tier)}</span>` : '‚Äî'}</td>
      </tr>
    `;
  }).join('');
}

function renderCandidates() {
  const content = document.getElementById('candidatesContent');

  if (candidatesData.length === 0) {
    content.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üë•</div>
        <h3>No candidates yet</h3>
        <p>Add your first candidate to start the interview assessment process.</p>
        <button class="btn btn-candidate" onclick="openAddCandidateModal()">‚ûï Add Candidate</button>
      </div>
    `;
    return;
  }

  content.innerHTML = `
    <div class="candidates-grid">
      ${candidatesData.map((candidate, idx) => {
        const techAvg = calculateAvg(candidate, TECHNICAL_SKILLS);
        const softAvg = calculateAvg(candidate, SOFT_SKILLS);
        const overallAvg = calculateAvg(candidate, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
        const status = getCandidateStatus(candidate);
        const tierClass = getCardTierClass(candidate);

        return `
          <div class="character-card ${tierClass}" onclick="openCandidateModal(${idx})">
            <div class="card-header candidate-header">
              <div class="avatar">${getInitials(candidate.name)}</div>
              <div class="character-info">
                <div class="character-name">${candidate.name}</div>
                <span class="character-role">${candidate.role}</span>
                <div class="candidate-meta">
                  <span class="candidate-status ${status}">${getCandidateStatusLabel(status)}</span>
                  ${candidate.source ? `<span class="candidate-meta-item">via ${candidate.source}</span>` : ''}
                </div>
              </div>
              ${overallAvg ? `<div class="level-badge">LVL ${Math.floor(parseFloat(overallAvg))}</div>` : ''}
            </div>
            <div class="xp-section">
              <div class="xp-group">
                <div class="xp-group-header">
                  <span class="xp-group-title">Technical Skills</span>
                  <span class="xp-group-score">${techAvg || '‚Äî'}</span>
                </div>
                <div class="xp-bar-container">
                  <div class="xp-bar-fill" style="width: ${getXPPercentage(techAvg)}%"></div>
                </div>
              </div>
              <div class="xp-group">
                <div class="xp-group-header">
                  <span class="xp-group-title">Soft Skills</span>
                  <span class="xp-group-score">${softAvg || '‚Äî'}</span>
                </div>
                <div class="xp-bar-container">
                  <div class="xp-bar-fill" style="width: ${getXPPercentage(softAvg)}%"></div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <div class="overall-score">
                <span class="overall-label">Overall</span>
                <span class="overall-value">${overallAvg || '‚Äî'}</span>
              </div>
              <button class="view-profile-btn" style="background: var(--candidate)" onclick="event.stopPropagation(); openCandidateModal(${idx})">
                ${status === 'new' ? 'Start Interview ‚Üí' : 'Continue ‚Üí'}
              </button>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

function openProfile(idx) {
  currentPersonIdx = idx;
  const person = teamData[idx];
  const techAvg = calculateAvg(person, TECHNICAL_SKILLS);
  const softAvg = calculateAvg(person, SOFT_SKILLS);
  const archAvg = person.role === 'Architect' ? calculateAvg(person, ARCHITECT_SKILLS) : null;
  const allSkills = person.role === 'Architect'
    ? [...TECHNICAL_SKILLS, ...SOFT_SKILLS, ...ARCHITECT_SKILLS]
    : [...TECHNICAL_SKILLS, ...SOFT_SKILLS];
  const overallAvg = calculateAvg(person, allSkills);
  const techBadge = getBadgeTier(techAvg);
  const softBadge = getBadgeTier(softAvg);
  const archBadge = person.role === 'Architect' ? getBadgeTier(archAvg) : null;
  const overallBadge = getBadgeTier(overallAvg);

  document.getElementById('modalHeader').innerHTML = `
    <div class="modal-avatar">${getInitials(person.name)}</div>
    <div class="modal-character-info">
      <h2>${person.name}</h2>
      <span class="character-role">${person.role}</span>
      <div class="modal-badges">
        ${techBadge ? `<span class="badge ${techBadge} earned">${getBadgeIcon(techBadge)} Technical ${getBadgeLabel(techBadge)}</span>` : ''}
        ${softBadge ? `<span class="badge ${softBadge} earned">${getBadgeIcon(softBadge)} Soft Skills ${getBadgeLabel(softBadge)}</span>` : ''}
        ${archBadge ? `<span class="badge ${archBadge} earned">${getBadgeIcon(archBadge)} Architect ${getBadgeLabel(archBadge)}</span>` : ''}
        ${overallBadge ? `<span class="badge ${overallBadge} earned">${getBadgeIcon(overallBadge)} Overall ${getBadgeLabel(overallBadge)}</span>` : ''}
      </div>
    </div>
  `;

  const architectSection = person.role === 'Architect' ? `
    <div class="skills-section architect-section">
      <div class="skills-header">
        <span class="skills-title">üèõÔ∏è Architect Skills</span>
        <span class="skills-avg">${archAvg || '‚Äî'} / 5.0</span>
      </div>
      ${ARCHITECT_SKILLS.map(skill => renderSkillRow(person, skill, false, false, true)).join('')}
    </div>
  ` : '';

  document.getElementById('modalBody').innerHTML = `
    <div class="context-legend">
      <span class="context-legend-title">Context Guide:</span>
      <span class="context-legend-item">üìÅ Projects completed</span>
      <span class="context-legend-item">ü§ù Customer at-bats</span>
      ${person.role === 'Architect' ? '<span class="context-legend-item">üè¢ Engagements managed</span>' : ''}
    </div>
    <div class="skills-section">
      <div class="skills-header">
        <span class="skills-title">‚ö° Technical Skills</span>
        <span class="skills-avg">${techAvg || '‚Äî'} / 5.0</span>
      </div>
      ${TECHNICAL_SKILLS.map(skill => renderSkillRow(person, skill, true, false)).join('')}
    </div>
    <div class="skills-section">
      <div class="skills-header">
        <span class="skills-title">üéØ Soft Skills</span>
        <span class="skills-avg">${softAvg || '‚Äî'} / 5.0</span>
      </div>
      ${SOFT_SKILLS.map(skill => renderSkillRow(person, skill, false, false)).join('')}
    </div>
    ${architectSection}
  `;

  document.getElementById('profileModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function renderSkillRow(person, skill, isTechnical, isCandidate = false, isArchitect = false) {
  const score = person.scores[skill.key] || null;
  const contextData = person.contextData || {};
  const contextValue = contextData[skill.key] || 0;
  let rubrics;
  if (isArchitect) {
    rubrics = ARCHITECT_RUBRICS[skill.key];
  } else if (isTechnical) {
    rubrics = TECHNICAL_RUBRICS[skill.key];
  } else {
    rubrics = SOFT_RUBRICS[skill.key];
  }
  const onclickFn = isCandidate ? `toggleCandidateSkillRubric('${skill.key}')` : `toggleSkillRubric('${skill.key}')`;
  const scoreFn = isCandidate ? 'setCandidateScore' : 'setScore';
  const contextFn = isCandidate ? 'setCandidateContext' : 'setContext';

  const skillType = isArchitect ? 'architect' : (isTechnical ? 'technical' : 'soft');
  const contextLabel = CONTEXT_LABELS[skillType];

  return `
    <div class="skill-row" id="${isCandidate ? 'candidate-' : ''}skill-${skill.key}">
      <div class="skill-main" onclick="${onclickFn}">
        <div class="skill-info">
          <div class="skill-name">${skill.label}</div>
          <div class="skill-current-desc">${getCurrentLevelDesc(skill.key, score, isTechnical, isArchitect)}</div>
        </div>
        <div class="skill-controls">
          <div class="context-badge" onclick="event.stopPropagation();" title="${contextLabel.label}">
            <span class="context-icon">${contextLabel.icon}</span>
            <input type="number" min="0" max="999" class="context-input"
                   value="${contextValue}"
                   onchange="${contextFn}('${skill.key}', this.value)"
                   onclick="event.stopPropagation();">
          </div>
          <div class="skill-score-input">
            ${[1,2,3,4,5].map(n => `
              <button class="score-btn ${score === n ? 'active' : ''}"
                      onclick="event.stopPropagation(); ${scoreFn}('${skill.key}', ${n}, '${skillType}')">
                ${n}
              </button>
            `).join('')}
            <span class="expand-icon">‚ñº</span>
          </div>
        </div>
      </div>
      <div class="skill-rubric">
        <table class="rubric-table">
          <thead><tr><th>Level</th><th>Criteria</th></tr></thead>
          <tbody>
            ${rubrics.map(r => `
              <tr class="${score === r.score ? 'current-level' : ''}">
                <td class="rubric-score">${r.score}</td>
                <td>${r.desc}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
}

function toggleSkillRubric(skillKey) {
  document.getElementById(`skill-${skillKey}`).classList.toggle('expanded');
}

function toggleCandidateSkillRubric(skillKey) {
  document.getElementById(`candidate-skill-${skillKey}`).classList.toggle('expanded');
}

function setScore(skillKey, score, skillType) {
  if (currentPersonIdx === null) return;
  const person = teamData[currentPersonIdx];
  const oldTechBadge = getBadgeTier(calculateAvg(person, TECHNICAL_SKILLS));
  const oldSoftBadge = getBadgeTier(calculateAvg(person, SOFT_SKILLS));
  const oldArchBadge = person.role === 'Architect' ? getBadgeTier(calculateAvg(person, ARCHITECT_SKILLS)) : null;

  person.scores[skillKey] = person.scores[skillKey] === score ? null : score;
  localStorage.setItem('leanscale_scorecard_v2', JSON.stringify(teamData));

  const newTechBadge = getBadgeTier(calculateAvg(person, TECHNICAL_SKILLS));
  const newSoftBadge = getBadgeTier(calculateAvg(person, SOFT_SKILLS));
  const newArchBadge = person.role === 'Architect' ? getBadgeTier(calculateAvg(person, ARCHITECT_SKILLS)) : null;

  if (skillType === 'technical' && newTechBadge && newTechBadge !== oldTechBadge && getTierRank(newTechBadge) > getTierRank(oldTechBadge)) {
    showAchievement(newTechBadge, 'Technical');
  } else if (skillType === 'soft' && newSoftBadge && newSoftBadge !== oldSoftBadge && getTierRank(newSoftBadge) > getTierRank(oldSoftBadge)) {
    showAchievement(newSoftBadge, 'Soft Skills');
  } else if (skillType === 'architect' && newArchBadge && newArchBadge !== oldArchBadge && getTierRank(newArchBadge) > getTierRank(oldArchBadge)) {
    showAchievement(newArchBadge, 'Architect');
  }

  openProfile(currentPersonIdx);
  renderRoleGrids();
  renderTeamGrid();
  renderLeaderboard();
}

function setCandidateScore(skillKey, score, isTechnical) {
  if (currentCandidateIdx === null) return;
  const candidate = candidatesData[currentCandidateIdx];
  candidate.scores[skillKey] = candidate.scores[skillKey] === score ? null : score;
  saveCandidates();
  openCandidateModal(currentCandidateIdx);
  renderCandidates();
}

function setContext(skillKey, value) {
  if (currentPersonIdx === null) return;
  const person = teamData[currentPersonIdx];
  if (!person.contextData) person.contextData = {};
  person.contextData[skillKey] = parseInt(value) || 0;
  localStorage.setItem('leanscale_scorecard_v2', JSON.stringify(teamData));
  // Don't re-render the whole modal to preserve cursor position
}

function setCandidateContext(skillKey, value) {
  if (currentCandidateIdx === null) return;
  const candidate = candidatesData[currentCandidateIdx];
  if (!candidate.contextData) candidate.contextData = {};
  candidate.contextData[skillKey] = parseInt(value) || 0;
  saveCandidates();
  // Don't re-render to preserve cursor position
}

function getTierRank(tier) {
  const ranks = { bronze: 1, silver: 2, gold: 3, platinum: 4 };
  return ranks[tier] || 0;
}

function showAchievement(tier, category) {
  const popup = document.getElementById('achievementPopup');
  document.getElementById('achievementIcon').textContent = getBadgeIcon(tier);
  document.getElementById('achievementTitle').textContent = `${getBadgeLabel(tier)} Badge Earned!`;
  document.getElementById('achievementDesc').textContent = `${teamData[currentPersonIdx].name} reached ${getBadgeLabel(tier)} tier in ${category}!`;
  popup.classList.add('show');
  setTimeout(() => popup.classList.remove('show'), 2500);
}

function closeModal() {
  document.getElementById('profileModal').classList.remove('active');
  document.body.style.overflow = '';
  currentPersonIdx = null;
}

// Candidate functions
function openAddCandidateModal() {
  document.getElementById('addCandidateModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeAddCandidateModal() {
  document.getElementById('addCandidateModal').classList.remove('active');
  document.body.style.overflow = '';
  document.getElementById('addCandidateForm').reset();
}

function addCandidate(e) {
  e.preventDefault();
  const firstName = document.getElementById('candidateFirstName').value.trim();
  const lastName = document.getElementById('candidateLastName').value.trim();
  const email = document.getElementById('candidateEmail').value.trim();
  const role = document.getElementById('candidateRole').value;
  const source = document.getElementById('candidateSource').value.trim();

  const candidate = {
    name: `${firstName} ${lastName}`,
    email,
    role,
    source,
    scores: {},
    notes: {},
    createdAt: new Date().toISOString()
  };

  candidatesData.push(candidate);
  saveCandidates();
  closeAddCandidateModal();
  renderCandidates();
  openCandidateModal(candidatesData.length - 1);
}

function openCandidateModal(idx) {
  currentCandidateIdx = idx;
  currentInterviewSection = 'all';
  const candidate = candidatesData[idx];
  const techAvg = calculateAvg(candidate, TECHNICAL_SKILLS);
  const softAvg = calculateAvg(candidate, SOFT_SKILLS);
  const overallAvg = calculateAvg(candidate, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
  const status = getCandidateStatus(candidate);

  document.getElementById('candidateModalHeader').innerHTML = `
    <div class="modal-avatar">${getInitials(candidate.name)}</div>
    <div class="modal-character-info">
      <h2>${candidate.name}</h2>
      <span class="character-role">${candidate.role}</span>
      <div class="candidate-meta" style="margin-top: 0.5rem;">
        <span class="candidate-status ${status}">${getCandidateStatusLabel(status)}</span>
        ${candidate.email ? `<span class="candidate-meta-item">${candidate.email}</span>` : ''}
        ${candidate.source ? `<span class="candidate-meta-item">via ${candidate.source}</span>` : ''}
      </div>
      <div class="modal-badges">
        ${getBadgeTier(techAvg) ? `<span class="badge ${getBadgeTier(techAvg)} earned">${getBadgeIcon(getBadgeTier(techAvg))} Technical</span>` : ''}
        ${getBadgeTier(softAvg) ? `<span class="badge ${getBadgeTier(softAvg)} earned">${getBadgeIcon(getBadgeTier(softAvg))} Soft Skills</span>` : ''}
      </div>
    </div>
  `;

  renderCandidateModalBody(candidate);
  document.getElementById('candidateModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function renderCandidateModalBody(candidate) {
  const isArchitect = candidate.role === 'Architect';
  const techAvg = calculateAvg(candidate, TECHNICAL_SKILLS);
  const softAvg = calculateAvg(candidate, SOFT_SKILLS);
  const archAvg = isArchitect ? calculateAvg(candidate, ARCHITECT_SKILLS) : null;
  const totalSkills = TECHNICAL_SKILLS.length + SOFT_SKILLS.length + (isArchitect ? ARCHITECT_SKILLS.length : 0);
  const scoredSkills = Object.values(candidate.scores || {}).filter(v => v && v > 0).length;

  // Filter skills based on section
  let techSkillsToShow = TECHNICAL_SKILLS;
  let softSkillsToShow = SOFT_SKILLS;
  let archSkillsToShow = isArchitect ? ARCHITECT_SKILLS : [];

  if (currentInterviewSection === 'pipeline') {
    techSkillsToShow = TECHNICAL_SKILLS.filter(s => s.category === 'Pipeline Ops');
    softSkillsToShow = [];
    archSkillsToShow = [];
  } else if (currentInterviewSection === 'revenue') {
    techSkillsToShow = TECHNICAL_SKILLS.filter(s => s.category === 'Revenue Ops');
    softSkillsToShow = [];
    archSkillsToShow = [];
  } else if (currentInterviewSection === 'soft') {
    techSkillsToShow = [];
    archSkillsToShow = [];
  } else if (currentInterviewSection === 'architect') {
    techSkillsToShow = [];
    softSkillsToShow = [];
    archSkillsToShow = isArchitect ? ARCHITECT_SKILLS : [];
  }

  const architectTabHtml = isArchitect ? `
    <button class="interview-section-tab ${currentInterviewSection === 'architect' ? 'active' : ''}" onclick="setInterviewSection('architect')">
      Architect <span class="tab-count">${ARCHITECT_SKILLS.length}</span>
    </button>
  ` : '';

  const architectSectionHtml = archSkillsToShow.length > 0 ? `
    <div class="skills-section architect-section">
      <div class="skills-header">
        <span class="skills-title">üèõÔ∏è Architect Skills</span>
        <span class="skills-avg">${archAvg || '‚Äî'} / 5.0</span>
      </div>
      ${archSkillsToShow.map(skill => renderInterviewQuestion(candidate, skill, false, true)).join('')}
    </div>
  ` : '';

  document.getElementById('candidateModalBody').innerHTML = `
    <div class="interview-progress">
      <div class="interview-progress-header">
        <span class="interview-progress-title">Assessment Progress</span>
        <span class="interview-progress-count">${scoredSkills} / ${totalSkills} skills assessed</span>
      </div>
      <div class="interview-progress-bar">
        <div class="interview-progress-fill" style="width: ${(scoredSkills/totalSkills)*100}%"></div>
      </div>
    </div>

    <div class="interview-section-tabs">
      <button class="interview-section-tab ${currentInterviewSection === 'all' ? 'active' : ''}" onclick="setInterviewSection('all')">
        All Skills <span class="tab-count">${totalSkills}</span>
      </button>
      <button class="interview-section-tab ${currentInterviewSection === 'pipeline' ? 'active' : ''}" onclick="setInterviewSection('pipeline')">
        Pipeline Ops <span class="tab-count">6</span>
      </button>
      <button class="interview-section-tab ${currentInterviewSection === 'revenue' ? 'active' : ''}" onclick="setInterviewSection('revenue')">
        Revenue Ops <span class="tab-count">6</span>
      </button>
      <button class="interview-section-tab ${currentInterviewSection === 'soft' ? 'active' : ''}" onclick="setInterviewSection('soft')">
        Soft Skills <span class="tab-count">5</span>
      </button>
      ${architectTabHtml}
    </div>

    ${techSkillsToShow.length > 0 ? `
      <div class="skills-section">
        <div class="skills-header">
          <span class="skills-title">‚ö° Technical Skills</span>
          <span class="skills-avg">${techAvg || '‚Äî'} / 5.0</span>
        </div>
        ${techSkillsToShow.map(skill => renderInterviewQuestion(candidate, skill, true)).join('')}
      </div>
    ` : ''}

    ${softSkillsToShow.length > 0 ? `
      <div class="skills-section">
        <div class="skills-header">
          <span class="skills-title">üéØ Soft Skills</span>
          <span class="skills-avg">${softAvg || '‚Äî'} / 5.0</span>
        </div>
        ${softSkillsToShow.map(skill => renderInterviewQuestion(candidate, skill, false)).join('')}
      </div>
    ` : ''}

    ${architectSectionHtml}

    <div class="interview-nav">
      <button class="btn btn-danger btn-sm" onclick="deleteCandidate(${currentCandidateIdx})">üóëÔ∏è Delete Candidate</button>
      <button class="btn btn-primary" onclick="hireCandidate(${currentCandidateIdx})">‚úÖ Move to Team</button>
    </div>
  `;
}

function renderInterviewQuestion(candidate, skill, isTechnical, isArchitect = false) {
  const score = candidate.scores[skill.key] || null;
  const notes = candidate.notes[skill.key] || '';
  const contextData = candidate.contextData || {};
  const contextValue = contextData[skill.key] || '';
  const question = INTERVIEW_QUESTIONS[skill.key];
  let rubrics;
  if (isArchitect) {
    rubrics = ARCHITECT_RUBRICS[skill.key];
  } else if (isTechnical) {
    rubrics = TECHNICAL_RUBRICS[skill.key];
  } else {
    rubrics = SOFT_RUBRICS[skill.key];
  }
  const skillType = isArchitect ? 'architect' : (isTechnical ? 'technical' : 'soft');
  const contextLabel = CONTEXT_LABELS[skillType];

  return `
    <div class="interview-question-card">
      <div class="interview-question-header">
        <div>
          <div class="interview-skill-label">${skill.label}</div>
          <div class="interview-question">"${question.primary}"</div>
        </div>
        <div class="interview-context-badge" title="${contextLabel.label} (optional - from prior experience)">
          <span class="context-icon">${contextLabel.icon}</span>
          <input type="number" min="0" max="999" class="interview-context-input"
                 value="${contextValue}"
                 placeholder="‚Äî"
                 onchange="setCandidateContext('${skill.key}', this.value)">
        </div>
      </div>
      <div class="interview-followup">
        <strong>Follow-up:</strong> ${question.followup}<br>
        <strong style="color: var(--candidate);">${question.lookFor}</strong>
      </div>
      <div class="interview-scoring">
        ${[1,2,3,4,5].map(n => `
          <button class="interview-score-btn ${score === n ? 'selected' : ''}"
                  onclick="setCandidateScoreFromInterview('${skill.key}', ${n}, '${skillType}')">
            <span class="score-num">${n}</span>
            <span class="score-label">${rubrics[n-1].desc.split(';')[0].substring(0, 20)}...</span>
          </button>
        `).join('')}
      </div>
      <div class="interview-notes">
        <textarea placeholder="Notes from interview..."
                  onchange="setCandidateNotes('${skill.key}', this.value)">${notes}</textarea>
      </div>
    </div>
  `;
}

function setInterviewSection(section) {
  currentInterviewSection = section;
  renderCandidateModalBody(candidatesData[currentCandidateIdx]);
}

function setCandidateScoreFromInterview(skillKey, score, isTechnical) {
  if (currentCandidateIdx === null) return;
  const candidate = candidatesData[currentCandidateIdx];
  candidate.scores[skillKey] = candidate.scores[skillKey] === score ? null : score;
  saveCandidates();
  renderCandidateModalBody(candidate);
  renderCandidates();
}

function setCandidateNotes(skillKey, notes) {
  if (currentCandidateIdx === null) return;
  candidatesData[currentCandidateIdx].notes[skillKey] = notes;
  saveCandidates();
}

function deleteCandidate(idx) {
  if (confirm(`Are you sure you want to delete ${candidatesData[idx].name}? This cannot be undone.`)) {
    candidatesData.splice(idx, 1);
    saveCandidates();
    closeCandidateModal();
    renderCandidates();
  }
}

function hireCandidate(idx) {
  const candidate = candidatesData[idx];
  if (confirm(`Move ${candidate.name} to the team as ${candidate.role}?`)) {
    teamData.push({
      name: candidate.name,
      role: candidate.role,
      scores: { ...candidate.scores }
    });
    candidatesData.splice(idx, 1);
    saveCandidates();
    saveData();
    closeCandidateModal();
    renderCandidates();
    renderTeamGrid();
    renderRoleGrids();
    renderLeaderboard();
    showToast(`${candidate.name} added to the team!`);
  }
}

function closeCandidateModal() {
  document.getElementById('candidateModal').classList.remove('active');
  document.body.style.overflow = '';
  currentCandidateIdx = null;
}

function saveCandidates() {
  localStorage.setItem('leanscale_candidates', JSON.stringify(candidatesData));
}

function saveData() {
  localStorage.setItem('leanscale_scorecard_v2', JSON.stringify(teamData));
  saveCandidates();
  showToast('Progress saved!');
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = '‚ú® ' + message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2000);
}

// Event listeners
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal();
    closeAddCandidateModal();
    closeCandidateModal();
  }
});

document.getElementById('profileModal').addEventListener('click', (e) => {
  if (e.target.id === 'profileModal') closeModal();
});

document.getElementById('addCandidateModal').addEventListener('click', (e) => {
  if (e.target.id === 'addCandidateModal') closeAddCandidateModal();
});

document.getElementById('candidateModal').addEventListener('click', (e) => {
  if (e.target.id === 'candidateModal') closeCandidateModal();
});

document.querySelectorAll('.nav-link').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.nav-link').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

function renderCompactCard(person, idx) {
  const techAvg = calculateAvg(person, TECHNICAL_SKILLS);
  const softAvg = calculateAvg(person, SOFT_SKILLS);
  const overallAvg = calculateAvg(person, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
  const tierClass = getCardTierClass(person);
  const techBadge = getBadgeTier(techAvg);
  const softBadge = getBadgeTier(softAvg);
  const overallBadge = getBadgeTier(overallAvg);

  return `
    <div class="character-card-compact ${tierClass}" onclick="openProfile(${idx})">
      <div class="compact-header">
        <div class="compact-avatar">${getInitials(person.name)}</div>
        <div class="compact-info">
          <div class="compact-name">${person.name}</div>
          <div class="compact-level">${overallAvg ? `Level ${Math.floor(parseFloat(overallAvg))}` : 'Unrated'}</div>
        </div>
        ${overallBadge ? `<span class="compact-badge">${getBadgeIcon(overallBadge)}</span>` : ''}
      </div>
      <div class="compact-stats">
        <div class="compact-stat">
          <div class="compact-stat-value">${techAvg || '‚Äî'}</div>
          <div class="compact-stat-label">Technical</div>
        </div>
        <div class="compact-stat">
          <div class="compact-stat-value">${softAvg || '‚Äî'}</div>
          <div class="compact-stat-label">Soft Skills</div>
        </div>
        <div class="compact-stat">
          <div class="compact-stat-value">${overallAvg || '‚Äî'}</div>
          <div class="compact-stat-label">Overall</div>
        </div>
      </div>
      <div class="compact-badges">
        ${techBadge ? `<span class="badge ${techBadge} earned">${getBadgeIcon(techBadge)} Tech</span>` : ''}
        ${softBadge ? `<span class="badge ${softBadge} earned">${getBadgeIcon(softBadge)} Soft</span>` : ''}
      </div>
    </div>
  `;
}

function renderRoleGrids() {
  const architects = [], engineers = [];
  teamData.forEach((person, idx) => {
    if (person.role === 'Architect') architects.push({ person, idx });
    else engineers.push({ person, idx });
  });

  document.getElementById('architectGrid').innerHTML = architects.map(({ person, idx }) => renderCompactCard(person, idx)).join('');
  document.getElementById('engineerGrid').innerHTML = engineers.map(({ person, idx }) => renderCompactCard(person, idx)).join('');
  document.getElementById('architectCount').textContent = `${architects.length} members`;
  document.getElementById('engineerCount').textContent = `${engineers.length} members`;

  function getRoleAvgs(members) {
    const techAvgs = [], softAvgs = [], overallAvgs = [];
    members.forEach(({ person }) => {
      const t = calculateAvg(person, TECHNICAL_SKILLS);
      const s = calculateAvg(person, SOFT_SKILLS);
      const o = calculateAvg(person, [...TECHNICAL_SKILLS, ...SOFT_SKILLS]);
      if (t) techAvgs.push(parseFloat(t));
      if (s) softAvgs.push(parseFloat(s));
      if (o) overallAvgs.push(parseFloat(o));
    });
    return {
      tech: techAvgs.length ? (techAvgs.reduce((a,b)=>a+b,0)/techAvgs.length).toFixed(1) : '‚Äî',
      soft: softAvgs.length ? (softAvgs.reduce((a,b)=>a+b,0)/softAvgs.length).toFixed(1) : '‚Äî',
      overall: overallAvgs.length ? (overallAvgs.reduce((a,b)=>a+b,0)/overallAvgs.length).toFixed(1) : '‚Äî'
    };
  }

  const architectAvgs = getRoleAvgs(architects);
  const engineerAvgs = getRoleAvgs(engineers);

  document.getElementById('architectTech').textContent = architectAvgs.tech;
  document.getElementById('architectSoft').textContent = architectAvgs.soft;
  document.getElementById('architectOverall').textContent = architectAvgs.overall;
  document.getElementById('engineerTech').textContent = engineerAvgs.tech;
  document.getElementById('engineerSoft').textContent = engineerAvgs.soft;
  document.getElementById('engineerOverall').textContent = engineerAvgs.overall;
}

// Initial render
renderRoleGrids();
renderTeamGrid();
renderLeaderboard();
renderCandidates();
</script>
</body>
</html>
